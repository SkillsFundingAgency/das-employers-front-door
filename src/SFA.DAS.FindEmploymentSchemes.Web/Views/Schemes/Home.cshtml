@model HomeModel

@section PreviewErrors {
    @await Html.PartialAsync("_PreviewErrorsPartial", Model.Preview)
}

<iframe id="existing-iframe-example"
        width="560" height="315"
        src="https://www.youtube-nocookie.com/embed/xWUFLAAc4TY?enablejsapi=1&&origin=https://localhost:44318"
        title="YouTube video player"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen="">
</iframe>

@*<iframe id="existing-iframe-example"
        width="640" height="360"
        src="https://www.youtube.com/embed/M7lc1UVf-VE?enablejsapi=1"
        frameborder="0"
        style="border: solid 4px #37474F"
></iframe>*@

@*<script type="text/javascript">
    var tag = document.createElement('script');
    tag.id = 'iframe-demo';
    tag.src = 'https://www.youtube.com/iframe_api';
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('existing-iframe-example', {
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }
    function onPlayerReady(event) {
        (".ytp-title-channel-logo").attr('aria-label', 'proof');
        document.getElementById('existing-iframe-example').style.borderColor = '#FF6D00';
    }
    function changeBorderColor(playerStatus) {
        var color;
        if (playerStatus == -1) {
            color = "#37474F"; // unstarted = gray
        } else if (playerStatus == 0) {
            color = "#FFFF00"; // ended = yellow
        } else if (playerStatus == 1) {
            color = "#33691E"; // playing = green
        } else if (playerStatus == 2) {
            color = "#DD2C00"; // paused = red
        } else if (playerStatus == 3) {
            color = "#AA00FF"; // buffering = purple
        } else if (playerStatus == 5) {
            color = "#FF6DOO"; // video cued = orange
        }
        if (color) {
            document.getElementById('existing-iframe-example').style.borderColor = color;
        }
    }
    function onPlayerStateChange(event) {
        changeBorderColor(event.data);
    }
</script>
*@
<div id="scheme-home-outer-two-thirds" class="govuk-grid-row">
    <div id="scheme-home-inner-two-thirds" class="govuk-grid-column-two-thirds">
        @Model.Preamble
    </div>
</div>

<div id="scheme-home-filter-outer" class="govuk-grid-row app-filter-layout">
    <div id="scheme-home-filter-inner" class="govuk-grid-column-one-third app-filter-layout__filter">
        <div id="scheme-filter" class="das-filter app-filter @(Model.EnsureSchemesAreVisible?"app-hide-on-mobile-no-js":"")" tabindex="0" data-module="app-show-hide">
            <form id="scheme-home-filter-form" action="/" method="post">
                <div id="scheme-home-filter-header-container" class="das-filter__header app-filter__header">
                    <h2 id="scheme-home-filter-header" class="das-filter__heading">Filter schemes to fit your business</h2>
                    <button id="close-filter" class="govuk-button govuk-button--secondary">Close</button>
                </div>
                <div id="scheme-filter-options" class="das-filter__body">
                    <div id="number-of-schemes-box">
                        <span id="number-of-schemes-heading" class="govuk-heading-s">Number of Schemes: <span id="number-of-schemes" role="status">@Model.Schemes.Count()</span></span>
                    </div>
                        @foreach (var filter in Model.Filters)
                        {
                            @await Html.PartialAsync("_FilterGroupPartial", filter)
                        }
                        
                        <a id="clear-filters" asp-route="@(Model.Preview.IsPreview?"home-preview":"home")" class="govuk-link">Clear filters</a>
                    
                        <div id="scheme-home-filter-form-button-group" class="govuk-button-group app-js-desktop-hide">
                            <button id="filter-box-filter-schemes" class="govuk-button govuk-button--secondary govuk-!-margin-bottom-0">Filter schemes</button>
                        </div>
                </div>
            </form>
        </div>
    </div>
    <div id="schemes" class="govuk-grid-column-two-thirds app-filter-layout__content">
        <div id="scheme-home-schemes-container-inner" class="govuk-button-group">
            @if (Model.EnsureSchemesAreVisible)
            {
                <form id="mobile-no-js-filter-form" method="post" action="/?show=filter">
                    <button class="govuk-button govuk-button--secondary app-show-on-mobile-no-js">Filter schemes</button>
                </form>
            }
            <a id="filter-schemes" class="govuk-button das-js-show--inline" href="#scheme-filter" data-text-show="Filter schemes" data-text-hide="Hide filter" data-class-hide="govuk-button--secondary">Filter schemes</a>
            <a id="compare-schemes" class="govuk-button govuk-button--secondary" asp-route="@(Model.Preview.IsPreview?"scheme-comparison-preview":"scheme-comparison")">Compare schemes in a table</a>
        </div>
        @foreach (var scheme in Model.Schemes)
        {
            @await Html.PartialAsync("_SchemePartial", (scheme, Model.Preview))
        }
    </div>
</div>

<script asp-add-nonce>
    document.addEventListener("DOMContentLoaded", function() {
        $("#close-filter,#filter-box-filter-schemes").click(function(e) {
            $([document.documentElement, document.body]).animate({ scrollTop: $("#scheme-home-filter-outer").offset().top }, 0);
            hideFilterBox();
            e.preventDefault();
        });

        $("#filter-schemes").click(function() {
            onFilterBoxOpenClose();
            document.activeElement.blur();
        });

        $("#schemes").removeClass("govuk-grid-column-two-thirds").addClass("govuk-grid-column-full");

        if (window.document.documentMode) {
            /* if the user agent is ie, fall back to non-js based filtering */
            $('.das-js-hide').show();
        }
        else {
            initFiltering();
        }

        onFilterBoxOpenClose();
    });
</script>